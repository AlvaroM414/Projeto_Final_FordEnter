<div class="controle-container">
    <h2>Controle de Finan√ßas</h2>
    <div class="transacoes">
        <!-- Lista de transa√ß√µes e formul√°rios -->
        <div class="stats-container">
            <div class="stat-card" style="border-left: 5px solid var(--success);">
                <div class="stat-label">Receitas do M√™s</div>
                <div class="stat-value" style="color: var(--success);">{{ resumo.receitas |
                    currency:'BRL':'symbol':'1.2-2':'pt' }}</div>
            </div>
            <div class="stat-card" style="border-left: 5px solid var(--accent);">
                <div class="stat-label">Despesas do M√™s</div>
                <div class="stat-value" style="color: var(--accent);">{{ resumo.despesas |
                    currency:'BRL':'symbol':'1.2-2':'pt' }}</div>
            </div>
            <div class="stat-card"
                [ngStyle]="{'border-left.px': 5, 'border-left-style': 'solid', 'border-left-color': resumo.saldo >= 0 ? 'var(--success)' : 'var(--accent)'}">
                <div class="stat-label">SALDO MENSAL</div>
                <div class="stat-value" [ngStyle]="{'color': resumo.saldo >= 0 ? 'var(--success)' : 'var(--accent)'}">
                    {{ resumo.saldo | currency:'BRL':'symbol':'1.2-2':'pt' }}
                </div>
            </div>
        </div>

        <div class="controlar-container mt-20">
            <div class="card controlar-form">
                <h2>‚ûï Nova Transa√ß√£o</h2>
                <form (ngSubmit)="adicionarTransacao()" #transacaoForm="ngForm">

                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="tipo">Tipo</label>
                            <select id="tipo" name="tipo" [(ngModel)]="novaTransacao.tipo" required>
                                <option value="receita">Receita</option>
                                <option value="despesa">Despesa</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="valor">Valor (R$)</label>
                            <input type="number" id="valor" name="valor" [(ngModel)]="novaTransacao.valor" step="0.01"
                                min="0.01" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="descricao">Descri√ß√£o</label>
                        <input type="text" id="descricao" name="descricao" [(ngModel)]="novaTransacao.descricao"
                            placeholder="Ex: Sal√°rio, Aluguel, Supermercado" required>
                    </div>

                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="categoria">Categoria</label>
                            <select id="categoria" name="categoria" [(ngModel)]="novaTransacao.categoria" required>
                                <optgroup label="Receitas" *ngIf="novaTransacao.tipo === 'receita'">
                                    <option value="salario">Sal√°rio</option>
                                    <option value="investimento">Investimento</option>
                                    <option value="outras_receitas">Outras</option>
                                </optgroup>
                                <optgroup label="Despesas" *ngIf="novaTransacao.tipo === 'despesa'">
                                    <option value="moradia">Moradia</option>
                                    <option value="alimentacao">Alimenta√ß√£o</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="lazer">Lazer</option>
                                    <option value="saude">Sa√∫de</option>
                                    <option value="outros">Outras</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="formaPagamento">Forma de Pgto.</label>
                            <select id="formaPagamento" name="formaPagamento" [(ngModel)]="novaTransacao.formaPagamento"
                                required>
                                <option value="dinheiro">Dinheiro</option>
                                <option value="cartao">Cart√£o de Cr√©dito/D√©bito</option>
                                <option value="pix">PIX/Transfer√™ncia</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="dataTransacao">Data</label>
                        <input type="date" id="dataTransacao" name="dataTransacao" [(ngModel)]="novaTransacao.data"
                            required>
                    </div>

                    <button type="submit" class="btn btn-success" [disabled]="!transacaoForm.valid">
                        Adicionar {{ novaTransacao.tipo === 'receita' ? 'Receita' : 'Despesa' }}
                    </button>
                </form>
            </div>

            <div class="card">
                <h2>üìä An√°lise por Categoria</h2>
                <div id="analiseCategoria">
                    <div class="analise-item" *ngIf="analiseCategorias.length === 0">
                        <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                            Adicione transa√ß√µes para visualizar a an√°lise por categoria.
                        </p>
                    </div>

                    <div class="analise-item" *ngFor="let analise of analiseCategorias">
                        <div class="analise-info">
                            <strong>{{ getNomeCategoria(analise.categoria) }}</strong>
                            <p class="small-text">Despesas: <span class="text-danger">{{ analise.totalDespesas |
                                    currency:'BRL':'symbol' }}</span></p>
                            <p class="small-text">Receitas: <span class="text-success">{{ analise.totalReceitas |
                                    currency:'BRL':'symbol' }}</span></p>
                        </div>
                        <div class="analise-saldo"
                            [ngClass]="getTipoClasse(analise.saldo >= 0 ? 'receita' : 'despesa')">
                            {{ analise.saldo | currency:'BRL':'symbol' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-20">
            <h2>üßæ Hist√≥rico de Transa√ß√µes</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Descri√ß√£o</th>
                            <th>Categoria</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Forma Pgto.</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="listaTransacoes">
                        <tr *ngFor="let t of transacoes">
                            <td>{{ t.data | date: 'dd/MM/yyyy' }}</td>
                            <td>{{ t.descricao }}</td>
                            <td>{{ getNomeCategoria(t.categoria) }}</td>
                            <td [ngClass]="getTipoClasse(t.tipo)">{{ t.tipo | titlecase }}</td>
                            <td [ngClass]="getTipoClasse(t.tipo)">{{ t.valor | currency:'BRL':'symbol':'1.2-2':'pt' }}
                            </td>
                            <td>{{ t.formaPagamento | titlecase }}</td>
                            <td>
                                <button class="btn-sm btn-danger" (click)="removerTransacao(t.id)">üóëÔ∏è</button>
                            </td>
                        </tr>
                        <tr *ngIf="transacoes.length === 0">
                            <td colspan="7" class="instruction">
                                Nenhuma transa√ß√£o cadastrada. Adicione sua primeira transa√ß√£o acima!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>